<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ’ãƒ¨ã‚³é¤Œã‚„ã‚Šãƒãƒˆãƒ«</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f0f4f8;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            touch-action: none; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
            user-select: none;
            -webkit-user-select: none;
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        #startScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.8);
            z-index: 10;
        }
        h1 {
            font-size: 40px;
            margin-bottom: 20px;
            color: #333;
        }
        p {
            font-size: 20px;
            color: #555;
            text-align: center;
            line-height: 1.6;
        }
        button {
            padding: 15px 40px;
            font-size: 24px;
            background-color: #ffcc00;
            border: 4px solid #333;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            font-family: inherit;
            box-shadow: 4px 4px 0 #333;
            transition: transform 0.1s;
        }
        button:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #333;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <div id="startScreen">
        <h1>ãƒ’ãƒ¨ã‚³ã«ã”ã¯ã‚“</h1>
        <p>
            <span style="font-size:30px;">ğŸ‘ˆ ã‚¹ãƒ¯ã‚¤ãƒ—ã§ç§»å‹• ğŸ‘‰</span><br>
            <span style="font-size:30px;">ğŸ‘† ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼ˆ2æ®µå¯ï¼‰</span><br>
            <span style="font-size:30px;">ğŸ’¥ ä½“å½“ãŸã‚Šã§æ‰“ã¡è¿”ã™ï¼ˆä½“åŠ›æ¶ˆè²»ï¼‰</span><br>
            <span style="font-size:30px;">ğŸ– é•·æŠ¼ã—ã§é£Ÿã¹ã‚‹ï¼ˆå›å¾©ï¼‰</span>
        </p>
        <button onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ -->
    <div id="gameOverScreen" class="hidden">
        <h1>ã¤ã‹ã‚Œã¡ã‚ƒã£ãŸ...</h1>
        <p>ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
        <button onclick="resetGame()">ã‚‚ã†ä¸€å›ã‚„ã‚‹</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = 'start'; // start, playing, gameover
        let score = 0;
        let maxHealth = 100;
        let health = 100;
        let frameCount = 0;

        // ç”»é¢ã‚µã‚¤ã‚ºèª¿æ•´
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // å®šæ•°
        const GRAVITY = 0.6;
        const GROUND_Y = () => canvas.height - 100;

        // ã‚¢ã‚»ãƒƒãƒˆï¼ˆçµµæ–‡å­—ãªã©ï¼‰
        const FOODS = ['ğŸ', 'ğŸ™', 'ğŸ–', 'ğŸ©', 'ğŸ¥•'];
        const CLOUDS = [
            {x: 50, y: 100, w: 120, h: 60, speed: 0.5},
            {x: 300, y: 200, w: 150, h: 80, speed: 0.3},
            {x: 600, y: 120, w: 100, h: 50, speed: 0.7}
        ];

        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        const player = {
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            width: 40,
            height: 80,
            color: '#333',
            grounded: false,
            jumpCount: 0,
            isEating: false, // é•·æŠ¼ã—çŠ¶æ…‹
            eatCharge: 0
        };

        const chick = {
            x: 0,
            y: 100,
            size: 60,
            targetX: 0,
            emoji: 'ğŸ¥',
            msg: '',
            msgTimer: 0
        };

        let foodList = [];
        let particles = [];

        // åˆæœŸåŒ–
        function init() {
            player.x = canvas.width / 2;
            player.y = GROUND_Y();
            chick.x = canvas.width / 2;
            chick.targetX = Math.random() * (canvas.width - 100) + 50;
            foodList = [];
            particles = [];
            score = 0;
            health = 100;
            frameCount = 0;
        }

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            init();
            gameState = 'playing';
            loop();
        }

        function resetGame() {
            startGame();
        }

        function gameOver() {
            gameState = 'gameover';
            document.getElementById('finalScore').innerText = score;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        // å…¥åŠ›å‡¦ç†
        let touchStartX = 0;
        let touchStartTime = 0;
        let isTouching = false;

        // ã‚¿ãƒƒãƒé–‹å§‹
        canvas.addEventListener('touchstart', (e) => {
            if (gameState !== 'playing') return;
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartTime = Date.now();
            isTouching = true;
            player.isEating = false;
        }, {passive: false});

        // ã‚¹ãƒ¯ã‚¤ãƒ—ç§»å‹• & é•·æŠ¼ã—åˆ¤å®š
        canvas.addEventListener('touchmove', (e) => {
            if (gameState !== 'playing') return;
            e.preventDefault();
            const touch = e.touches[0];
            const diffX = touch.clientX - touchStartX;

            // ç§»å‹•å‡¦ç†ï¼ˆæ„Ÿåº¦èª¿æ•´ï¼‰
            player.x += diffX * 1.5;
            
            // ç”»é¢ç«¯åˆ¶é™
            if (player.x < 20) player.x = 20;
            if (player.x > canvas.width - 20) player.x = canvas.width - 20;

            touchStartX = touch.clientX; // æ¬¡ã®è¨ˆç®—ã®ãŸã‚ã«æ›´æ–°
        }, {passive: false});

        // ã‚¿ãƒƒãƒçµ‚äº†ï¼ˆã‚¿ãƒƒãƒ—åˆ¤å®šï¼‰
        canvas.addEventListener('touchend', (e) => {
            if (gameState !== 'playing') return;
            e.preventDefault();
            isTouching = false;
            player.isEating = false;

            const touchDuration = Date.now() - touchStartTime;
            
            // çŸ­ã„ã‚¿ãƒƒãƒ—ãªã‚‰ã‚¸ãƒ£ãƒ³ãƒ—
            // é•·æŠ¼ã—åˆ¤å®šã«ãªã£ã¦ã„ãªã‘ã‚Œã°ã‚¸ãƒ£ãƒ³ãƒ—
            if (touchDuration < 250) {
                if (player.grounded) {
                    player.vy = -15;
                    player.grounded = false;
                    player.jumpCount = 1;
                    createParticles(player.x, player.y + 40, 5, '#ccc');
                } else if (player.jumpCount < 2) {
                    player.vy = -12;
                    player.jumpCount = 2;
                    createParticles(player.x, player.y + 40, 5, '#fff');
                }
            }
        }, {passive: false});


        // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
        function loop() {
            if (gameState !== 'playing') return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            update();
            draw();
            
            requestAnimationFrame(loop);
        }

        function update() {
            frameCount++;

            // é•·æŠ¼ã—åˆ¤å®š
            if (isTouching) {
                if (Date.now() - touchStartTime > 300) { // 300msä»¥ä¸ŠæŠ¼ã—ã¦ãŸã‚‰ã€Œé£Ÿã¹ã‚‹ãƒ¢ãƒ¼ãƒ‰ã€
                    player.isEating = true;
                }
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç‰©ç†æ¼”ç®—
            player.vy += GRAVITY;
            player.y += player.vy;

            // ç€åœ°åˆ¤å®š
            if (player.y > GROUND_Y()) {
                player.y = GROUND_Y();
                player.vy = 0;
                player.grounded = true;
                player.jumpCount = 0;
            }

            // ãƒ’ãƒ¨ã‚³ã®ç§»å‹•
            const dx = chick.targetX - chick.x;
            chick.x += dx * 0.02;
            if (Math.abs(dx) < 10 && Math.random() < 0.01) {
                chick.targetX = Math.random() * (canvas.width - 100) + 50;
            }

            // é£Ÿã¹ç‰©ç”Ÿæˆ
            if (frameCount % 60 === 0) { // 1ç§’ã«1å€‹ãã‚‰ã„
                spawnFood();
            }

            // é£Ÿã¹ç‰©æ›´æ–°
            for (let i = foodList.length - 1; i >= 0; i--) {
                let f = foodList[i];
                f.vy += GRAVITY * 0.5;
                f.x += f.vx;
                f.y += f.vy;
                f.rot += f.rotSpeed;

                // åœ°é¢ã«è½ã¡ãŸã‚‰æ¶ˆãˆã‚‹
                if (f.y > canvas.height + 50) {
                    foodList.splice(i, 1);
                    continue;
                }

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã®å½“ãŸã‚Šåˆ¤å®š
                // ç°¡æ˜“çš„ãªè·é›¢åˆ¤å®š
                const distX = Math.abs(player.x - f.x);
                const distY = Math.abs((player.y - player.height/2) - f.y); // ä¸­å¿ƒåº§æ¨™èª¿æ•´

                if (distX < 40 && distY < 60) {
                    if (player.isEating) {
                        // é£Ÿã¹ã‚‹ï¼ˆå›å¾©ï¼‰
                        health = Math.min(health + 10, maxHealth);
                        createParticles(f.x, f.y, 10, '#4CAF50'); // ç·‘ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                        showFloatingText(f.x, f.y, "ãƒ‘ã‚¯ãƒƒ!", "#4CAF50");
                        foodList.splice(i, 1);
                    } else {
                        // æ‰“ã¡è¿”ã™ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ï¼†ãƒã‚¦ãƒ³ãƒ‰ï¼‰
                        // ã™ã§ã«ä¸Šã«å‘ã‹ã£ã¦ã„ã‚‹å ´åˆã¯é€£ç¶šãƒ’ãƒƒãƒˆã•ã›ãªã„ãŸã‚ã®ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³çš„ãªåˆ¶å¾¡ãŒå¿…è¦ã ãŒã€
                        // ã“ã“ã§ã¯å˜ç´”ã«vyãŒä¸‹å‘ãã®ã¨ãã ã‘å¼¾ã
                        if (f.vy > 0) {
                            f.vy = -18; // ä¸Šã«å¼¾ã
                            f.vx = (Math.random() - 0.5) * 10; // æ¨ªã«ãƒ©ãƒ³ãƒ€ãƒ ã«æ•£ã‚‰ã™
                            health -= 5; // ä½“åŠ›æ¶ˆè²»
                            createParticles(f.x, f.y, 5, '#ff5555');
                            showFloatingText(player.x, player.y - 50, "-5", "red");
                            
                            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š
                            if (health <= 0) {
                                health = 0;
                                gameOver();
                            }
                        }
                    }
                }

                // ãƒ’ãƒ¨ã‚³ã¨ã®å½“ãŸã‚Šåˆ¤å®š
                const chickDist = Math.hypot(chick.x - f.x, chick.y - f.y);
                if (chickDist < 50 && f.vy < 0) { // ä¸Šã«å¼¾ã‹ã‚ŒãŸé£Ÿã¹ç‰©ã®ã¿
                    score += 100;
                    foodList.splice(i, 1);
                    chick.emoji = 'ğŸ˜‹';
                    chick.msg = 'ãŠã„ã—ã„!';
                    chick.msgTimer = 60;
                    createParticles(chick.x, chick.y, 15, '#FFD700');
                    // ãƒ’ãƒ¨ã‚³ç§»å‹•
                    chick.targetX = Math.random() * (canvas.width - 100) + 50;
                    
                    setTimeout(() => { chick.emoji = 'ğŸ¥'; }, 500);
                }
            }

            // é›²ã®ç§»å‹•
            CLOUDS.forEach(cloud => {
                cloud.x += cloud.speed;
                if (cloud.x > canvas.width + 100) cloud.x = -150;
            });

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ›´æ–°
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function draw() {
            // èƒŒæ™¯ã¨é›²
            drawClouds();

            // åœ°é¢
            ctx.beginPath();
            ctx.moveTo(0, GROUND_Y());
            ctx.lineTo(canvas.width, GROUND_Y());
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.stroke();
            ctx.font = '30px sans-serif';
            ctx.fillStyle = '#333';
            ctx.fillText('åœ°é¢', canvas.width/2 - 30, canvas.height - 30);

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»ï¼ˆæ‰‹æ›¸ãé¢¨æ£’äººé–“ï¼‰
            drawPlayer();

            // ãƒ’ãƒ¨ã‚³æç”»
            drawChick();

            // é£Ÿã¹ç‰©æç”»
            foodList.forEach(f => {
                ctx.save();
                ctx.translate(f.x, f.y);
                ctx.rotate(f.rot);
                ctx.font = '40px serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(f.type, 0, 0);
                ctx.restore();
            });

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });

            // UIæç”»
            drawUI();
        }

        function spawnFood() {
            foodList.push({
                x: Math.random() * (canvas.width - 40) + 20,
                y: -50,
                vx: 0,
                vy: 0,
                rot: 0,
                rotSpeed: (Math.random() - 0.5) * 0.2,
                type: FOODS[Math.floor(Math.random() * FOODS.length)]
            });
        }

        function drawPlayer() {
            const x = player.x;
            const y = player.y;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // ä½“ï¼ˆæ£’ï¼‰
            ctx.beginPath();
            ctx.moveTo(x, y); // è¶³å…ƒ
            ctx.lineTo(x, y - 50); // è…°ã‹ã‚‰é ­ã®ä¸‹
            ctx.stroke();

            // è¶³ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            ctx.beginPath();
            if (player.grounded) {
                if (Math.abs(touchStartX - x) > 5 && isTouching) {
                     // èµ°ã£ã¦ã‚‹é¢¨
                    ctx.moveTo(x, y);
                    ctx.lineTo(x - 15 + Math.sin(frameCount * 0.5)*10, y + 20);
                    ctx.moveTo(x, y);
                    ctx.lineTo(x + 15 - Math.sin(frameCount * 0.5)*10, y + 20);
                } else {
                    // ç›´ç«‹
                    ctx.moveTo(x, y);
                    ctx.lineTo(x - 10, y + 20); // å·¦è¶³
                    ctx.moveTo(x, y);
                    ctx.lineTo(x + 10, y + 20); // å³è¶³
                }
            } else {
                // ã‚¸ãƒ£ãƒ³ãƒ—ä¸­
                ctx.moveTo(x, y);
                ctx.lineTo(x - 15, y + 10);
                ctx.moveTo(x, y);
                ctx.lineTo(x + 15, y + 20);
            }
            ctx.stroke();

            // æ‰‹ï¼ˆæ‰“ã¡è¿”ã—ç”¨ï¼‰
            ctx.beginPath();
            // é£Ÿã¹ã‚‹ãƒ¢ãƒ¼ãƒ‰ä¸­ã¯å£ã‚’é–‹ã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§æ‰‹ã‚’é¡”ã®è¿‘ãã«
            if (player.isEating) {
                 ctx.moveTo(x, y - 30);
                 ctx.lineTo(x - 15, y - 45);
                 ctx.moveTo(x, y - 30);
                 ctx.lineTo(x + 15, y - 45);
            } else {
                // é€šå¸¸
                ctx.moveTo(x, y - 35);
                ctx.lineTo(x - 20, y - 20); // å·¦æ‰‹
                ctx.moveTo(x, y - 35);
                ctx.lineTo(x + 20, y - 50); // å³æ‰‹ï¼ˆä¸Šã’ã¦ã‚‹ï¼‰
            }
            ctx.stroke();

            // é ­
            ctx.beginPath();
            ctx.arc(x, y - 60, 15, 0, Math.PI * 2);
            ctx.stroke();

            // é£Ÿã¹ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã‚ªãƒ¼ãƒ©ï¼‰
            if (player.isEating) {
                ctx.strokeStyle = '#4CAF50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, y - 30, 50 + Math.sin(frameCount * 0.5) * 5, 0, Math.PI * 2);
                ctx.stroke();
                ctx.font = '16px serif';
                ctx.fillStyle = '#4CAF50';
                ctx.fillText('EAT!', x, y - 90);
            }
        }

        function drawChick() {
            ctx.font = '60px serif';
            ctx.textAlign = 'center';
            ctx.fillText(chick.emoji, chick.x, chick.y);

            if (chick.msgTimer > 0) {
                ctx.font = '20px serif';
                ctx.fillStyle = '#000';
                ctx.fillText(chick.msg, chick.x, chick.y - 40);
                chick.msgTimer--;
            }
        }

        function drawClouds() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            CLOUDS.forEach(c => {
                ctx.beginPath();
                ctx.ellipse(c.x, c.y, c.w, c.h, 0, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawUI() {
            // ã‚¹ã‚³ã‚¢
            ctx.fillStyle = '#000';
            ctx.font = '30px serif';
            ctx.textAlign = 'right';
            ctx.fillText(score, canvas.width - 20, 50);

            // ä½“åŠ›ã‚²ãƒ¼ã‚¸ï¼ˆç­‹è‚‰ã‚¢ã‚¤ã‚³ãƒ³ + ãƒãƒ¼ï¼‰
            const barX = 60;
            const barY = 30;
            const barW = 200;
            const barH = 20;

            // ç­‹è‚‰ã‚¢ã‚¤ã‚³ãƒ³
            ctx.font = '30px serif';
            ctx.textAlign = 'left';
            ctx.fillText('ğŸ’ª', 10, 50);

            // æ 
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.strokeRect(barX, barY, barW, barH);

            // ä¸­èº«
            const currentBarW = (health / maxHealth) * barW;
            if (health > 50) ctx.fillStyle = '#4CAF50';
            else if (health > 20) ctx.fillStyle = '#FFC107';
            else ctx.fillStyle = '#F44336';
            
            ctx.fillRect(barX, barY, currentBarW, barH);
            
            ctx.fillStyle = '#000';
            ctx.font = '16px serif';
            ctx.fillText('ä½“åŠ›ã‚²ãƒ¼ã‚¸', 10, 25);
        }

        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 30,
                    color: color,
                    size: Math.random() * 5 + 2
                });
            }
        }
        
        let floatTexts = [];
        function showFloatingText(x, y, text, color) {
            // ç°¡æ˜“å®Ÿè£…ã®ãŸã‚ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã¯åˆ¥ã«æç”»ãƒ«ãƒ¼ãƒ—å†…ã§å‡¦ç†ã™ã‚‹ã‹ã€
            // ç°¡ç•¥åŒ–ã®ãŸã‚ã“ã“ã§ã¯çœç•¥ã—ã€ãƒ­ã‚°ã‚„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã§ä»£ç”¨ã€‚
            // ä»Šå›ã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã§è¦–è¦šåŠ¹æœã‚’å‡ºã—ã¦ã„ã‚‹ã®ã§OKã¨ã™ã‚‹ã€‚
        }
    </script>
</body>
</html>
